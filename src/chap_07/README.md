# chapter 07 memo


## テスト戦略

### 1. ソフトウェアのアーキテクチャを考える
+ ここでいうソフトウェアアーキテクチャとは
    + モジュールの構成
    + インターフェイス
        + APIの有無
        + CLIの有無

### 2. どこまでテストをするべきか
+ どのレベルまでテストするか
    + トップレベル（ユーザとのやり取り部分）
    + モジュールの関数レベル
    + サブシステムレベル
+ UIを入れるかどうか
    + 入れると顧客向け機能のテスト（もしくはそれに対する結びつき）になるが、往々にして難しいテストになる
+ テストの担当範囲
    + あるテストが、他の範囲のテストに及ぶことはある。それをどこまでにするかどうか。
    + 例えば、システムテストはそのシステムだけで完結するか？

### ★ Cardアプリを例に考える
+ ソフトウェアアーキテクチャ
    + モジュールの構成
        + CLI 層 ：ほぼすべてのロジックがAPI層で実装。
        + API 層 ：実体はここ
        + DB 層 ：サードパッケージ１つのファイル。操作は完全に分離されている。
    + インターフェイス：あり
+ どのレベルまでテストするか
    + トップレベル（ユーザとのやり取り部分）：する
    + モジュールの関数レベル：API層（ただしCLIで api が正しく呼び出されているかのテストは必要）
    + サブシステムレベル：DB層のテストが必要と感じられる事態になったときにする。

## テストする機能をリスト化

### 1. リスト化する基準
+ Recent：新機能、追記コード、バグフィックス、リファクタリング等、追加修正などを行った箇所
+ Core：動作しないと製品として成り立たないもの
+ Risk：リスクになりえるところ。サードパーティライブラリを使っているところや、開発側はあまり触らないが顧客はよく使う部分など
+ Problematic：誤作動や不具合がしばしば報告される箇所
+ Expertise：専門知識が要求されるような、限られた人だけが使用する箇所

### ★ Cardアプリを例に考える
+ CoreとRiskだけ考える
+ Core：
    ```python 
    >>> dir(cards.cli)
    ['List', 'StringIO', 'Table', '__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__spec__', 'add', 'app', 'cards', 'cards_db', 'config', 'contextmanager', 'count', 'delete', 'finish', 'get_path', 'list_cards', 'main', 'os', 'pathlib', 'rich', 'start', 'typer', 'update', 'version']
    ```
    + `add`, `count`, `delete`, `finish`, `list_cards`, `start`, `update` はする
+ Risk：
    + サードパッケージ： `typer` と `tinydb` 
    + この２つにたいしてする。
    + よってDB層のテストは必要

## テストケース作成

次の手順で考えるとよいみたい
### 1.「自明でない」ハッピーパステストケースを作成（自明で無いというのは、ハードコードされていないや当たり前すぎない、みたいなことみたい）
### 2. このハッピーテストケースに対して以下の要素が入るテストケース
+ 興味深い入力
+ 興味深い開始状態
+ 興味深い終了状態
+ エラー状態として考えられるものすべて

### ★ Cardアプリのcountを例に考える
1. ハッピーパステストケースを作成
    + 例：DBに三枚カードが含まれるとき、Countが３を返す
1. ハッピーテストケースに対して
    + 興味深い入力
        + countにはパラメータが無いのでなし
    + 興味深い開始状態
        + DBが空である
        + DBにカード１枚含まれる
        + DBにカードｎ枚含まれる
    + 興味深い終了状態
        + countはDBを書き換え無いのでなし
    + エラー状態として考えられるものすべて
        + 思いつくものなし

## テスト戦略をメモに残しておく

+ 自分用のメモや、引き継ぎなども考えて《テスト戦略》をメモに残しておくと幸せ
+ ここでは
    + CLIを使った振る舞いテスト。このテストはAPIをできるだけ使って行う
    + CLIはただしいエンドポイントでAPIを呼び出しているかのテストを行う
    + 中核機能（`add`, `count`, `delete`, `finish`, `list_cards`, `start`, `update` ）は完全にテストする
    + dbはサブシステムテストとして行う

## その他メモ

### どこまでテストをするべきか
+ ユーザが使う機能（ユーザから見える機能の振る舞い）
+ セキュリティ
+ パフォーマンス
+ 負荷
+ 入力バリデーション

### 優先順位を決める
+ 最初のテストで行うものとして妥当なテスト（Cardsアプリを例に）
    + ユーザから見える機能の振る舞い
    + DBを共有していないので、セキュリティ、パフォーマンス、負荷は後回しでOK
    + シングルユーザのままであれば、入力バリデーションも後回しでOK。ただし、不正な入力テストだけはすべき。


## 用語

### テストスイート
テストの目的やテストの対象ごとに複数のテストをひとまとめにしたもの。自動テストでは実行単位になり得るもの。

### サブシステム
![](https://xtech.nikkei.com/it/article/COLUMN/20051102/223966/zu44.jpg)
- 負荷テストの設計例<BR>システム構造をサブシステムとデータベースに模式化し，サブシステムに負荷をかける操作を洗い出して，どのサブシステムにどんな負荷をかけるかを決定する
- 参照：[知っておきたいテストの“イロハ”（5）日経クロステック トップ](https://xtech.nikkei.com/it/article/COLUMN/20051102/223966/)

### ハッピーパス
すべてが完璧に進んでいるときにユーザーがたどるパス
例外やエラーの状態のないデフォルトのシナリオ

